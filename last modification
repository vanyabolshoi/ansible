---
- name: Find users who have not logged in since 2024 (fast method)
  hosts: windows
  gather_facts: no

  tasks:

    - name: Get old user folders
      win_shell: |
        $limitDate = Get-Date "2024-01-01"

        Get-ChildItem C:\Users -Directory |
        Where-Object {
            $_.Name -notin @('Public','Default','Default User','All Users','Administrator') -and
            $_.LastWriteTime -lt $limitDate
        } |
        Select-Object FullName, LastWriteTime |
        Sort-Object LastWriteTime |
        Format-Table -AutoSize

      register: old_users

    - name: Show result
      debug:
        var: old_users.stdout_lines
