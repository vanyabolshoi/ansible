---
- name: Find all users who have not logged in since 2026
  hosts: windows
  gather_facts: no

  tasks:

    - name: Get users with last logon before 2026
      win_shell: |
        $limitDate = Get-Date "2026-01-01"

        Get-LocalUser |
        Where-Object {
            $_.Enabled -eq $true -and
            $_.Name -notin @('Administrator','DefaultAccount','Guest') -and
            $_.LastLogon -lt $limitDate
        } |
        Select-Object Name, @{Name='LastLogon';Expression={$_.LastLogon.ToString("yyyy-MM-dd HH:mm:ss")}} |
        ConvertTo-Json

      register: old_users

    - name: Show result
      debug:
        msg: "{{ old_users.stdout | from_json }}"
