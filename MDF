- name: Создать батник noblock для 1С с именем базы из первого .mdf
  hosts: windows
  gather_facts: no

  tasks:
    - name: Найти файлы .mdf в C:\DataSQL
      win_find:
        paths: C:\DataSQL
        patterns: "*.mdf"
      register: mdf_files

    - name: Создать батник C:\temp\noblock.bat
      win_copy:
        dest: "C:\\temp\\noblock.bat"
        content: |
          chcp 866
          @echo off
          cls
          "C:\Program Files\1cv8\8.3.16.1224\bin\1cv8.exe" ENTERPRISE /S "localhost\{{ mdf_files.files[0].filename | replace('.mdf','') }}" /N ИмяПользователя /P Пароль /DisableStartupMessages /C "DisableBlocking"
