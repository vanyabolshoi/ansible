- name: Создать батник для 1С с динамическим именем базы
  hosts: windows
  gather_facts: no

  tasks:
    - name: Найти файлы .mdf в C:\DataSQL
      win_find:
        paths: C:\DataSQL
        patterns: "*.mdf"
      register: mdf_files

    - name: Создать батник для каждого файла
      win_copy:
        dest: "C:\\temp\\run_{{ item.filename | replace('.mdf','') }}.bat"
        content: |
          chcp 866
          @echo off
          cls
          "C:\Program Files\1cv8\8.3.16.1224\bin\1cv8.exe" ENTERPRISE /S "localhost\{{ item.filename | replace('.mdf','') }}" /N ИмяПользователя /P Пароль /DisableStartupMessages /C "DisableBlocking"
      loop: "{{ mdf_files.files }}"
