---
- name: Переименование Windows-машин по порядку
  hosts: windows
  gather_facts: no
  vars:
    prefix: "PC"
    start_number: 201

  tasks:
    - name: Получить список всех Windows-хостов
      set_fact:
        all_windows: "{{ query('inventory_hostnames', 'windows') }}"

    - name: Вычислить номер для текущего хоста
      set_fact:
        new_number: "{{ start_number + all_windows.index(inventory_hostname) }}"

    - name: Переименовать компьютер
      ansible.windows.win_hostname:
        name: "{{ prefix }}{{ new_number }}"

    - name: Перезагрузить машину после переименования
      ansible.windows.win_reboot:
        msg: "Перезагрузка после переименования"
        reboot_timeout: 600
