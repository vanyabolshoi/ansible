- name: Проверка доступности WinRM на Windows-хостах
  hosts: windows
  gather_facts: false

  tasks:
    - name: Проверить доступность WinRM
      win_ping:
      register: winrm_result
      ignore_errors: true

    - name: Вывести результат WinRM
      debug:
        msg: >
          {{ inventory_hostname }}: WinRM
          {% if winrm_result is defined and winrm_result.ping is defined %}
            доступен
          {% else %}
            недоступен
          {% endif %}
